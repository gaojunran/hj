# 提交

## 创建提交

::: details 对于熟悉 git 的用户

与 git 不同，jj：

- 没有暂存区（或叫索引区）；
- 工作区的所有变更默认提交到一个叫 **工作副本** 的特殊顶端提交中；
- 新添加的文件不需要显式地 `add` 即可被追踪，但 `.gitignore` 仍然有效。

`hj commit <message>`近似于：

```sh
git add -p
git commit -m message
```

:::

::: details 对于熟悉 jj 的用户

`hj commit <message>`的实质是：

```sh
jj commit --interactive --message message
```

这本质上是拆分一个提交，使用 `jj split` 也可以实现。

:::

在初始化仓库后，你就可以开始工作了！你在此仓库里做的 **所有变更操作** 都会被自动跟踪（被忽略的文件除外）。

每当你实现了一部分工作，例如新增了一个功能、修复了一个 bug 等，就可以对这部分修改创建一个**提交（commit）**：

```sh
hj commit "feat: add new feature"
```

在 `commit` 子命令后加一个可选参数，填写此次提交的描述信息。

命令会弹出一个终端交互式界面，可以在界面中选择要提交的文件。按下 `f` 键可以展开单个文件，选择具体的变更行。选择完成后，按下 `c` 键提交。

如果你在 `hj commit` 命令中没有给出提交描述信息，命令会认为你想先选择文件、后提供描述。选择完成后，命令会提示你输入提交描述信息。

完成后，可以查看当前仓库的状态：

```sh
hj
```

:::tip

为了极致的效率，大多数 hj 命令都有短缩写。 例如 `commit` 可以简写为 `cm`，`status` 可以简写为 `st`。这是我们最常用的两个缩写。

:::

## 增补提交

::: details 对于熟悉 git 的用户

`hj amend`近似于：

```sh
git add -p
git commit --amend
```

:::

::: details 对于熟悉 jj 的用户

`hj amend`的实质是：

```sh
jj squash --interactive
```

事实上 `squash` 命令已经足够简单，但 `amend` 语义更加明确、功能更加单一，所以我们提供了 `amend` 命令。

:::

如果你在提交后，发现漏掉了一些内容、或者有些已提交的代码有误，可以继续编辑文件之后后进行 **提交的增补（amend）**。增补的部分会合入上一个提交中：

```sh
hj amend
```

同样会弹出一个交互式界面，你可以选择要提交的文件和变更行。

## 撤回提交

::: details 对于熟悉 git 的用户

`hj reset`近似于：

```sh
git reset --soft HEAD^
```

:::

::: details 对于熟悉 jj 的用户

`hj reset`的实质是：

```sh
jj squash --from @- --into @
```

这个命令将清空 `@-`，故 jj 会自动丢弃这个提交。

撤回一个提交和增补一个提交一样，本质上都是将两个提交合并成一个。

事实上 `squash` 命令已经足够简单，但 `reset` 语义更加明确、功能更加单一，所以我们提供了 `reset` 命令。

:::

:::warning

这是一个不稳定的 API。我还在思考如何优雅地实现这个功能。

:::

通常增补提交能够解决大多数提交的问题。必要的时候你也可以 **撤回提交** ，例如当你发现你错误地多提交了某些内容时：

```sh
hj reset
```

这将把 **最新一次提交**（工作副本除外）撤回，保留其更改并合并到工作副本中。换言之，撤回后当前工作副本中保存着 **原有变更** 和 **刚刚撤回的变更**、甚至包括 **被撤回提交的描述信息**。你可以继续编辑工作副本并重新提交：

```sh
hj commit
```
